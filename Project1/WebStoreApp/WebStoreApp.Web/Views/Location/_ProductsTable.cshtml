@model WebStoreApp.Web.Models.ProductsViewModel
<form method="POST" asp-action="Order">
    <input type="hidden" asp-for="LocationId" value="@Model.LocationId" />
    <input type="submit" value="Place Orders" class="btn btn-primary" />
    <table class="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Products[0].Name)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Products[0].Price)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Products[0].Quantity)
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @for(var i = 0; i < Model.Products.Count; i++)
            {
                var product = Model.Products[i];
                var deleteId = $"btn-delete-{product.Id.ToString()}";
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => product.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => product.Price)
                    </td>
                    <td>
                        <input type="hidden" asp-for="Orders[i].ProductId" value="@product.Id" />
                        <input type="number" asp-for="Orders[i].Quantity" value="0"/>
                        @Html.DisplayFor(modelItem => product.Quantity)
                    </td>
                    <td>
                        <button type="button" id="btn-delete-@product.Id" class="btn">Delete</button> | 
                        <button type="button" id="btn-edit-@product.Id"class="btn" >Edit</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</form>

<script>
    const products = JSON.parse('@Html.Raw(Json.Serialize(Model.Products))');
    products.forEach(product => {
        document.getElementById("btn-edit-" + product.id).addEventListener("click", () =>
        {
            document.getElementById("edit-product-name").value = product.name;
            document.getElementById("edit-product-price").value = product.price;
            document.getElementById("edit-product-quantity").value = product.quantity;
            document.getElementById("edit-product-id").value = product.id;
            document.getElementById("edit-modal").style.display = "block";
        });

        document.getElementById("btn-delete-" + product.id).addEventListener("click", () => {
            document.getElementById("delete-product-id").value = product.id;
            document.getElementById("delete-modal").style.display = "block";
        })
    });
    window.addEventListener("click", (event) => {
        if(event.target == document.getElementById("edit-modal")) {
            document.getElementById("edit-modal").style.display = "none";
        }
        if(event.target == document.getElementById("delete-modal")) {
            document.getElementById("delete-modal").style.display = "none";
        }
    });
</script>

